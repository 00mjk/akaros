ELECTRIC-FENCE_TESTS_DIR = $(TESTS_DIR)/electric-fence

ELECTRIC-FENCE_TESTS_CFLAGS += $(CFLAGS_TESTS) -Wunused -Werror -D__NO_STRING_INLINES

ALL_ELECTRIC-FENCE_TEST_FILES := $(wildcard $(ELECTRIC-FENCE_TESTS_DIR)/*.c)

ELECTRIC-FENCE_TESTS_LDLIBS := $(TESTS_LDLIBS) -lelf -lelectric-fence

ELECTRIC-FENCE_TESTS_SRCS := $(ALL_ELECTRIC-FENCE_TEST_FILES)

ELECTRIC-FENCE_TESTS_LDDEPENDS := $(ELECTRIC-FENCE_TESTS_DIR)/%.c

TESTS_EXECS_C  += $(patsubst $(ELECTRIC-FENCE_TESTS_DIR)/%.c, \
                      $(OBJDIR)/$(ELECTRIC-FENCE_TESTS_DIR)/%, \
                      $(ELECTRIC-FENCE_TESTS_SRCS))

STATIC := $(findstring static,$(ELECTRIC-FENCE_TESTS_CFLAGS))
$(OBJDIR)/$(ELECTRIC-FENCE_TESTS_DIR)/%: $(ELECTRIC-FENCE_TESTS_LDDEPENDS)
	@echo + cc [ELECTRIC-FENCE_TESTS] $<
	@mkdir -p $(@D)
	$(Q)$(CC) $(ELECTRIC-FENCE_TESTS_CFLAGS) -o $@ $< $(ELECTRIC-FENCE_TESTS_LDLIBS)
	@if [ "$(STATIC)" != "static" ]; then \
		$(OBJDUMP) -S $@ > $@.asm; \
		$(NM) -n $@ > $@.sym; \
	fi
