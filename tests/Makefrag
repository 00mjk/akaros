TESTS_DIR = $(TOP_DIR)/tests
TESTS_CFLAGS += $(USER_FLAGS)
OBJDIRS += $(TESTS_DIR)

TESTS_CFLAGS := $(USER_CFLAGS)  \
                -I$(USER_DIR)/include

TESTS_LDFLAGS := -static

TESTS_LDDIRS := -L$(OBJDIR)/$(USER_PARLIB_DIR)

TESTS_LDLIBS := -lparlib 

TESTS_SRCS := \
              $(TESTS_DIR)/hart_test.c \
              $(TESTS_DIR)/pthread_test.c

TESTS_EXECS  := $(patsubst $(TESTS_DIR)/%.c, \
                           $(OBJDIR)/$(TESTS_DIR)/%, \
                           $(TESTS_SRCS))

TESTS_LDDEPENDS := $(TESTS_DIR)/%.c \
                   $(OBJDIR)/$(USER_PARLIB_DIR)/libparlib.a

$(OBJDIR)/$(TESTS_DIR)/%: $(TESTS_LDDEPENDS)
	@echo + cc [TESTS] $<
	@mkdir -p $(@D)
	$(V)$(CC) $(TESTS_CFLAGS) -o $@ $(TESTS_LDFLAGS) \
	          $(TESTS_LDDIRS) $(TESTS_LDLIBS) $<
	$(V)$(OBJDUMP) -S $@ > $@.asm
	$(V)$(NM) -n $@ > $@.sym

