TESTS_DIR = tests
OBJDIRS += $(TESTS_DIR)

TESTS_CFLAGS += $(USER_CFLAGS)  \
                -I$(USER_DIR)/include

ALL_TEST_FILES = $(shell ls $(TESTS_DIR)/*.c)

TESTS_LDDIRS := -L$(OBJDIR)/$(USER_PARLIB_DIR)

TESTS_LDLIBS := -lparlib 

TESTS_SRCS := $(ALL_TEST_FILES)

TESTS_EXECS  := $(patsubst $(TESTS_DIR)/%.c, \
                           $(OBJDIR)/$(TESTS_DIR)/%, \
                           $(TESTS_SRCS))

TESTS_LDDEPENDS := $(TESTS_DIR)/%.c \
                   $(OBJDIR)/$(USER_PARLIB_DIR)/libparlib.a

$(OBJDIR)/$(TESTS_DIR)/%: $(TESTS_LDDEPENDS)
	@echo + cc [TESTS] $<
	@mkdir -p $(@D)
	$(V)$(CC) $(TESTS_CFLAGS) -o $@ $(TESTS_LDFLAGS) \
	          $(TESTS_LDDIRS) $< $(TESTS_LDLIBS)
	$(V)$(OBJDUMP) -S $@ > $@.asm
	$(V)$(NM) -n $@ > $@.sym

